<!DOCTYPE html>
<html>
<head>
    <title>Cytoscape.js in JavaFX</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.30.2/cytoscape.min.js"></script>
    <style>
        #cy {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            background-color: #f5f6fa;
            z-index: 0;
        }
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div id="cy"></div>
    <script>
        // Debugging function to log to JavaFX console
        function log(message) {
            console.log(message);
            if (window.JavaBridge) {
                window.JavaBridge.log(message);
            }
        }

        try {
            // SVG as data URL for the node background
            const svgCircle = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><path fill="#5B9BD5" d="M64 320C64 178.6 178.6 64 320 64C461.4 64 576 178.6 576 320C576 461.4 461.4 576 320 576C178.6 576 64 461.4 64 320z"/></svg>');

            // Initialize Cytoscape.js
            var cy = cytoscape({
                container: document.getElementById('cy'),
                elements: [
                    { data: { id: 'a' } },
                    { data: { id: 'b' } },
                    { data: { source: 'a', target: 'b' } }
                ],
                style: [
                    {
                        selector: 'node',
                        style: {
                            'shape': 'ellipse',
                            'width': 60,
                            'height': 60,
                            'background-image': svgCircle,
                            'background-fit': 'cover',
                            'background-clip': 'node',
                            'background-opacity': 0, // Make default background transparent
                            'label': 'data(id)',
                            'text-valign': 'center',
                            'text-halign': 'center',
                            'color': '#ffffff',
                            'font-size': '14px',
                            'font-weight': '600',
                            'text-outline-width': 2,
                            'text-outline-color': '#2F6396',
                            'border-width': 2,
                            'border-color': '#2F6396',
                            'shadow-color': '#2F6396',
                            'shadow-opacity': 0.3,
                            'shadow-offset-x': 0,
                            'shadow-offset-y': 2,
                            'transition-property': 'border-color',
                            'transition-duration': '0.3s'
                        }
                    },
                    {
                        selector: 'edge',
                        style: {
                            'width': 2,
                            'line-color': '#A9B7C6',
                            'target-arrow-color': '#A9B7C6',
                            'target-arrow-shape': 'triangle',
                            'curve-style': 'bezier',
                            'transition-property': 'line-color',
                            'transition-duration': '0.3s'
                        }
                    },
                    {
                        selector: 'node:hover',
                        style: {
                            'border-color': '#1A4A7A',
                            'shadow-opacity': 0.5
                        }
                    },
                    {
                        selector: 'edge:hover',
                        style: {
                            'line-color': '#7A8B9A',
                            'target-arrow-color': '#7A8B9A'
                        }
                    }
                ],
                layout: {
                    name: 'grid',
                    rows: 1,
                    animate: true,
                    animationDuration: 500
                }
            });

            log('Cytoscape.js initialized successfully');

            // Function to add nodes dynamically
            window.addNode = function(id) {
                try {
                    cy.add({ data: { id: id } });
                    cy.layout({ name: 'grid', animate: true }).run();
                    log('Added node: ' + id);
                } catch (e) {
                    log('Error adding node: ' + e.message);
                }
            };

            // Ensure proper resizing for JavaFX WebView
            window.addEventListener('resize', function() {
                cy.resize();
                cy.fit();
            });
        } catch (e) {
            log('Error initializing Cytoscape.js: ' + e.message);
        }
    </script>
</body>
</html>